<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¸é†«ç—…ç†è¤‡ç¿’ç³»çµ± (å°ˆæ¥­å›å‚³ç‰ˆ)</title>
    <style>
        :root { --main: #2c3e50; --accent: #3498db; --success: #27ae60; --danger: #e74c3c; --bg: #f4f7f6; }
        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; background: var(--bg); margin: 0; padding: 0; }
        .nav-bar { background: var(--main); color: white; padding: 15px; text-align: center; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .container { max-width: 800px; margin: 20px auto; padding: 0 15px; padding-bottom: 50px; }
        .card { background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        /* é¸å–®æ¨£å¼ */
        .menu-grid { display: grid; grid-template-columns: 1fr; gap: 15px; margin-top: 20px; }
        .btn-chapter { background: white; border: 2px solid var(--accent); color: var(--accent); padding: 20px; border-radius: 10px; cursor: pointer; font-size: 1.1em; font-weight: bold; transition: 0.3s; text-align: center; }
        .btn-chapter:hover { background: var(--accent); color: white; }
        .btn-wrong-bank { background: #9b59b6; color: white; border: none; padding: 15px; border-radius: 10px; cursor: pointer; width: 100%; font-size: 1em; font-weight: bold; margin-top: 10px; }

        /* é¡Œç›®æ¨£å¼ */
        .q-block { margin-bottom: 30px; border-bottom: 1px solid #eee; padding-bottom: 20px; }
        .q-text { font-weight: bold; font-size: 1.1em; display: block; margin-bottom: 15px; line-height: 1.5; }
        .opt-list { list-style: none; padding: 0; }
        label { display: block; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 8px; cursor: pointer; }
        input[type="radio"] { display: none; }
        input[type="radio"]:checked + label { background: #e1f0fa; border-color: var(--accent); font-weight: bold; }

        /* å ±è¡¨èˆ‡è§£æ */
        .report-box { background: #2c3e50; color: #ecf0f1; padding: 15px; border-radius: 8px; font-family: monospace; white-space: pre-wrap; font-size: 0.85em; margin: 15px 0; max-height: 400px; overflow-y: auto; line-height: 1.6; }
        .feedback { padding: 10px; border-radius: 5px; margin-top: 10px; font-weight: bold; }
        .correct { background: #eafaf1; color: var(--success); }
        .wrong { background: #fdedec; color: var(--danger); }
        .exp { font-size: 0.9em; background: #f9f9f9; padding: 10px; border-left: 4px solid var(--accent); margin-top: 5px; color: #444; }

        .btn-main { background: var(--accent); color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; font-size: 1.1em; cursor: pointer; font-weight: bold; }
        .btn-secondary { background: #95a5a6; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; margin-top: 20px; width: 100%; }
        
        .report-opt-list { margin: 5px 0 5px 20px; padding: 0; list-style-type: circle; }
    </style>
</head>
<body>

<div class="nav-bar"><h2 id="top-title">ç¸é†«ç—…ç†è¤‡ç¿’ç³»çµ±</h2></div>

<div class="container">
    <div id="home-view" class="card">
        <h3>é¸æ“‡è¤‡ç¿’ç« ç¯€ï¼š</h3>
        <div id="chapter-list" class="menu-grid"></div>
        <hr style="margin: 25px 0; border: 0; border-top: 1px solid #eee;">
        <button class="btn-wrong-bank" onclick="showWrongBank()">ğŸ“• æŸ¥çœ‹å€‹äººéŒ¯é¡Œç´¯ç©æœ¬ (å«å®Œæ•´é¸é …)</button>
    </div>

    <div id="quiz-view" style="display:none;">
        <div id="quiz-content" class="card"></div>
        <button class="btn-main" onclick="gradeQuiz()">æäº¤ç­”æ¡ˆä¸¦ç”¢ç”Ÿæˆç¸¾å ±è¡¨</button>
        <button class="btn-secondary" onclick="goHome()">å–æ¶ˆæ¸¬é©—å›é¦–é </button>
    </div>

    <div id="result-view" style="display:none;">
        <div class="card">
            <h2 id="score-text" style="text-align:center;"></h2>
            <p><strong>ğŸ“‹ å®Œæ•´éŒ¯é¡Œè©³è§£å ±è¡¨ (è¤‡è£½å›å‚³)ï¼š</strong></p>
            <div id="report-text" class="report-box"></div>
            <button class="btn-main" style="background:var(--success);" onclick="copyReport()">ä¸€éµè¤‡è£½å®Œæ•´å ±è¡¨</button>
            <hr>
            <h3>ğŸ” é€é¡Œè§£æ</h3>
            <div id="review-content"></div>
            <button class="btn-secondary" onclick="goHome()">å›é¦–é </button>
        </div>
    </div>

    <div id="bank-view" style="display:none;">
        <div class="card">
            <h2>ğŸ“• å€‹äººéŒ¯é¡Œç´¯ç©æœ¬</h2>
            <div id="bank-content"></div>
            <button class="btn-main" onclick="goHome()">è¿”å›é¦–é </button>
            <button class="btn-secondary" style="background:var(--danger); margin-top:10px;" onclick="clearBank()">æ¸…ç©ºç´€éŒ„</button>
        </div>
    </div>
</div>

<script>
const quizDatabase = {
   "developmental_anomalies": {
        title: "ç¬¬ä¸€ç« ï¼šç™¼è‚²ç•°å¸¸èˆ‡ç•¸å½¢",
        questions: [
            { q: "ä¸‹åˆ—å“ªä¸€åè©æ­£ç¢ºæè¿°ã€Œå™¨å®˜åœ¨å‡ºç”Ÿæ™‚å®Œå…¨ä¸å­˜åœ¨ã€ï¼Ÿ", a: "Agenesis", o: ["Hypoplasia", "Agenesis", "Atrophy", "Dysplasia"], e: "Agenesisï¼ˆç™¼è‚²ä¸å…¨/ç¼ºå¦‚ï¼‰æŒ‡å™¨å®˜åŸåŸºæœªå½¢æˆï¼Œå°è‡´å™¨å®˜å®Œå…¨ä¸å­˜åœ¨ã€‚" },
            { q: "ä¸€éš»å¹¼çŠ¬å‡ºç”Ÿå³æœ‰å–®å´è…è‡Ÿé«”ç©æ˜é¡¯è¼ƒå°ï¼Œä½†ä»å…·æœ‰åŸºæœ¬çµæ§‹ï¼Œæœ€é©ç•¶çš„è¨ºæ–·ç‚ºï¼š", a: "Renal hypoplasia", o: ["Renal atrophy", "Renal aplasia", "Renal hypoplasia", "Renal degeneration"], e: "Hypoplasia æŒ‡å™¨å®˜é›–æœ‰ç™¼è‚²ä½†ç´°èƒæ•¸é‡ä¸è¶³ï¼Œå°è‡´é«”ç©æœªé”æ­£å¸¸ã€‚" },
            { q: "ä¸‹åˆ—å“ªä¸€ç—…è®Šã€Œæœ€ä¸å±¬æ–¼ã€ç¥ç¶“ç®¡é–‰åˆç•°å¸¸ï¼ˆNeural tube defectsï¼‰ï¼Ÿ", a: "Hydrocephalus", o: ["Spina bifida", "Anencephaly", "Meningocele", "Hydrocephalus"], e: "Hydrocephalusï¼ˆè…¦ç©æ°´ï¼‰å¤šèˆ‡è…¦è„Šæ¶²å¾ªç’°éšœç¤™æœ‰é—œï¼Œéå–®ç´”ç¥ç¶“ç®¡é–‰åˆå¤±æ•—ã€‚" },
            { q: "ç„¡è…¦ç—‡ï¼ˆAnencephalyï¼‰çš„ä¸»è¦ç—…ç†æ©Ÿè½‰ç‚ºï¼š", a: "ç¥ç¶“ç®¡å‰ç«¯æœªé–‰åˆ", o: ["é¡±éª¨æœªå½¢æˆå°è‡´è…¦éƒ¨æš´éœ²", "ç¥ç¶“ç®¡å‰ç«¯æœªé–‰åˆ", "è…¦å®¤å…§è…¦è„Šæ¶²éåº¦ç´¯ç©", "è…¦çµ„ç¹”å‡ºç”Ÿå¾Œé€€åŒ–"], e: "Anencephaly å±¬æ–¼ç¥ç¶“ç®¡ç¼ºé™·ï¼Œä¸»è¦æ˜¯ç¥ç¶“ç®¡å‰ç«¯ï¼ˆé ­ç«¯ï¼‰æœªé–‰åˆæ‰€è‡´ã€‚" },
            { q: "Persistent right aortic arch (PRAA) æœ€ä¸»è¦çš„ç—…ç†å½±éŸ¿ä½ç½®ç‚ºï¼š", a: "é£Ÿé“", o: ["æ°£ç®¡", "é£Ÿé“", "è‚ºå‹•è„ˆ", "å·¦å¿ƒå®¤"], e: "PRAA æœƒå½¢æˆè¡€ç®¡ç’°å£“è¿«é£Ÿé“ï¼Œå°è‡´é£Ÿé“ç‹¹çª„åŠè¿‘ç«¯æ“´å¼µã€‚" },
            { q: "PRAA æ‰€å°è‡´çš„ megaesophagusï¼ˆé£Ÿé“æ“´å¼µï¼‰ï¼Œå…¶å½¢æˆæ™‚é–“é»æœ€å¯èƒ½ç‚ºï¼š", a: "å‡ºç”Ÿå¾Œå› é£Ÿé“å£“è¿«é€æ¼¸å½¢æˆ", o: ["èƒšèƒæœŸç›´æ¥å½¢æˆ", "å‡ºç”Ÿå¾Œå› é£Ÿé“å£“è¿«é€æ¼¸å½¢æˆ", "è€å¹´é€€åŒ–é€ æˆ", "æ„ŸæŸ“å¼•èµ·æ€¥æ€§è®ŠåŒ–"], e: "PRAA æœ¬èº«æ˜¯å…ˆå¤©æ§‹é€ ç•°å¸¸ï¼Œä½†é£Ÿé“æ“´å¼µé€šå¸¸æ˜¯å‡ºç”Ÿé€²é£Ÿå¾Œå› å—å£“è¿«è€Œé€æ¼¸ç”¢ç”Ÿçš„æ¬¡ç™¼è®ŠåŒ–ã€‚" },
            { q: "ä¸‹åˆ—å“ªä¸€ç™¼è‚²ç•°å¸¸æœ€å¯èƒ½é€ æˆæ–°ç”Ÿå‹•ç‰©å‡ºç¾è‚ºç™¼è‚²ä¸å…¨ï¼Ÿ", a: "Congenital diaphragmatic hernia", o: ["Persistent ductus arteriosus", "Congenital diaphragmatic hernia", "Tracheal collapse", "Pulmonary edema"], e: "å…ˆå¤©æ€§æ©«è†ˆè†œç–æ°£å°è‡´è…¹è…”è‡Ÿå™¨é€²å…¥èƒ¸è…”ï¼Œå£“è¿«ç™¼è‚²ä¸­çš„è‚ºéƒ¨ï¼Œé€ æˆè‚ºç™¼è‚²ä¸è‰¯ï¼ˆPulmonary hypoplasiaï¼‰ã€‚" },
            { q: "å¤šå›Šè…ï¼ˆPolycystic kidney diseaseï¼‰åœ¨ç—…ç†åˆ†é¡ä¸Šæœ€é©åˆæ­¸é¡ç‚ºï¼š", a: "å›Šæ€§ç™¼è‚²ç•°å¸¸", o: ["ç‚ç—‡æ€§ç–¾ç—…", "å›Šæ€§ç™¼è‚²ç•°å¸¸", "è…«ç˜¤æ€§ç—…è®Š", "é€€è¡Œæ€§ç—…è®Š"], e: "é€™æ˜¯è…å°ç®¡ç™¼è‚²ç‘•ç–µå°è‡´çš„å¤šç™¼æ€§å›Šç‹€çµæ§‹å½¢æˆã€‚" },
            { q: "ä¸‹åˆ—å“ªä¸€é …æœ€ç¬¦åˆã€ŒTeratogenã€çš„å®šç¾©ï¼Ÿ", a: "èƒšèƒæˆ–èƒå…’æœŸé€ æˆçµæ§‹ç•°å¸¸çš„å› å­", o: ["é€ æˆå‡ºç”Ÿå¾Œå™¨å®˜é€€åŒ–çš„å› ç´ ", "å°è‡´è…«ç˜¤å½¢æˆçš„åŒ–å­¸ç‰©è³ª", "èƒšèƒæˆ–èƒå…’æœŸé€ æˆçµæ§‹ç•°å¸¸çš„å› å­", "æ”¹è®Šç´°èƒä»£è¬ä½†ä¸å½±éŸ¿ç™¼è‚²çš„ç‰©è³ª"], e: "Teratogenï¼ˆè‡´ç•¸èƒå› å­ï¼‰å°ˆæŒ‡åœ¨ç™¼è‚²éšæ®µé€ æˆçµæ§‹ç•¸å½¢çš„å› å­ã€‚" },
            { q: "ç‚ºä½•èƒšèƒç™¼è‚²æ—©æœŸæš´éœ²æ–¼è‡´ç•¸èƒå› å­æ™‚ï¼Œå¾Œæœé€šå¸¸è¼ƒåš´é‡ï¼Ÿ", a: "å› ç‚ºå™¨å®˜å½¢æˆèˆ‡åˆ†åŒ–æ­£åœ¨é€²è¡Œ", o: ["å› ç‚ºå…ç–«ç³»çµ±å°šæœªæˆç†Ÿ", "å› ç‚ºå™¨å®˜å½¢æˆèˆ‡åˆ†åŒ–æ­£åœ¨é€²è¡Œ", "å› ç‚ºè¡€æ¶²å¾ªç’°å°šæœªå»ºç«‹", "å› ç‚ºç´°èƒæ•¸é‡å°šä¸è¶³"], e: "å™¨å®˜å½¢æˆæœŸï¼ˆOrganogenesisï¼‰æ˜¯èƒšèƒå°è‡´ç•¸èƒå› å­æœ€æ•æ„Ÿçš„æ™‚æœŸã€‚" },
            { q: "ä¸‹åˆ—ä½•è€…å±¬æ–¼å¸¸è¦‹çš„çŠ¬å…ˆå¤©æ€§å¿ƒè¡€ç®¡ç™¼è‚²ç•°å¸¸ï¼Ÿ", a: "Persistent ductus arteriosus", o: ["Cardiomyopathy", "Atherosclerosis", "Persistent ductus arteriosus", "Endocarditis"], e: "Persistent ductus arteriosusï¼ˆå‹•è„ˆå°ç®¡æœªé–‰, PDAï¼‰æ˜¯å¸¸è¦‹çš„å…ˆå¤©æ€§å¿ƒè‡Ÿç—…ã€‚" },
            { q: "é—œæ–¼ hypoplasia èˆ‡ atrophy çš„æ¯”è¼ƒï¼Œä¸‹åˆ—ä½•è€…æ­£ç¢ºï¼Ÿ", a: "Atrophy åŸæœ¬å™¨å®˜æ›¾æ­£å¸¸ç™¼è‚²", o: ["å…©è€…çš†ç‚ºå‡ºç”Ÿå¾Œæ‰ç™¼ç”Ÿ", "Hypoplasia ç‚ºå¾Œå¤©é€€åŒ–", "Atrophy åŸæœ¬å™¨å®˜æ›¾æ­£å¸¸ç™¼è‚²", "å…©è€…åœ¨ç—…ç†ä¸Šç„¡æ³•å€åˆ†"], e: "èç¸®ï¼ˆAtrophyï¼‰æ˜¯ç™¼è‚²å®Œæˆå¾Œæ‰ç¸®å°ï¼›ç™¼è‚²ä¸è‰¯ï¼ˆHypoplasiaï¼‰æ˜¯èƒšèƒæœŸç™¼è‚²ä¸è¶³ã€‚" },
            { q: "ä¸‹åˆ—å“ªä¸€é …æœ€ç¬¦åˆã€ŒAgenesisã€çš„å®šç¾©ï¼Ÿ", a: "å™¨å®˜å®Œå…¨æœªå½¢æˆ", o: ["å™¨å®˜é«”ç©ç¸®å°", "å™¨å®˜å®Œå…¨æœªå½¢æˆ", "å™¨å®˜å‡ºç”Ÿå¾Œé€€åŒ–", "çµ„ç¹”åˆ†åŒ–ç•°å¸¸"], e: "Agenesis æŒ‡å™¨å®˜åŸåŸºå®Œå…¨æ²’æœ‰ç™¼è‚²ã€‚" },
            { q: "ä¸‹åˆ—å“ªä¸€é …æœ€ç¬¦åˆã€Œhypoplasiaã€çš„æ¦‚å¿µï¼Ÿ", a: "èƒšèƒæœŸç´°èƒæ•¸é‡ä¸è¶³", o: ["å™¨å®˜æ›¾æ­£å¸¸ç™¼è‚²å¾Œç¸®å°", "å™¨å®˜å®Œå…¨ç¼ºå¦‚", "èƒšèƒæœŸç´°èƒæ•¸é‡ä¸è¶³", "çµ„ç¹”æ’åˆ—ç•°å¸¸"], e: "Hypoplasia æŒ‡å™¨å®˜é›–æœ‰ç™¼è‚²ä½†ç´°èƒæ•¸é‡ä¸è¶³ã€‚" },
            { q: "ä¸‹åˆ—ä½•è€…æœ€å¯èƒ½èˆ‡éºå‚³æ€§ç™¼è‚²ç•°å¸¸ï¼ˆGenetic anomalyï¼‰æœ‰é—œï¼Ÿ", a: "Gene mutation", o: ["Gene mutation", "Bacterial infection", "Mechanical trauma", "Intoxication"], e: "éºå‚³æ€§ç•°å¸¸å¤šæºæ–¼åŸºå› çªè®Šæˆ–æŸ“è‰²é«”è®Šç•°ã€‚" },
            { q: "ä¸‹åˆ—å“ªä¸€é …ç—…è®Šæœ€ç¬¦åˆã€ŒVascular ring anomalyã€çš„ç‰¹å¾µï¼Ÿ", a: "Persistent right aortic arch", o: ["Persistent right aortic arch", "Atrial septal defect", "Cardiomyopathy", "Arteritis"], e: "PRAA æ˜¯ä¸€ç¨®å…¸å‹çš„è¡€ç®¡ç’°ç•°å¸¸ï¼Œæœƒå£“è¿«é£Ÿé“ã€‚" },
            { q: "ä¸‹åˆ—å“ªä¸€é …æœ€èƒ½è§£é‡‹å…ˆå¤©æ€§è…­è£‚ï¼ˆCleft palateï¼‰çš„ç—…ç†åŸå› ï¼Ÿ", a: "å·¦å³é¡çªèåˆå¤±æ•—", o: ["å·¦å³é¡çªèåˆå¤±æ•—", "å‡ºç”Ÿå¾Œå¤–å‚·", "æ…¢æ€§ç™¼ç‚", "è…«ç˜¤å£“è¿«"], e: "è…­è£‚ï¼ˆPalatoschisisï¼‰ä¸»å› æ˜¯å…©å´é¡çªï¼ˆPalatal shelvesï¼‰èåˆå¤±æ•—ã€‚" },
            { q: "ä¸‹åˆ—å“ªä¸€ç—…è®Šæœ€ç¬¦åˆ Dysplasia çš„æ¦‚å¿µï¼Ÿ", a: "ç‚ºç´°èƒæ’åˆ—èˆ‡åˆ†åŒ–ç•°å¸¸", o: ["ç‚ºå™¨å®˜å‡ºç”Ÿå¾Œé€€åŒ–", "ç‚ºç´°èƒæ’åˆ—èˆ‡åˆ†åŒ–ç•°å¸¸", "ç‚ºå™¨å®˜å®Œå…¨ç¼ºå¦‚", "ç‚ºå™¨å®˜é«”ç©ç¸®å°"], e: "Dysplasiaï¼ˆç™¼è‚²ç•°å¸¸ï¼‰æŒ‡çµ„ç¹”å…§çš„ç´°èƒåˆ†åŒ–èˆ‡æ’åˆ—çµæ§‹æ··äº‚ã€‚" },
            { q: "è®Šç•°ç™¼è‚²ï¼ˆDevelopmental Pathologyï¼‰çš„ç ”ç©¶é‡é»ç‚ºä½•ï¼Ÿ", a: "èƒšèƒèˆ‡èƒå…’æœŸçš„çµæ§‹ç•°å¸¸", o: ["èƒšèƒèˆ‡èƒå…’æœŸçš„çµæ§‹ç•°å¸¸", "æˆç†Ÿå‹•ç‰©çš„æ„ŸæŸ“æ€§ç–¾ç—…", "è€å¹´é€€è¡Œæ€§ç—…è®Š", "è…«ç˜¤å½¢æˆæ©Ÿè½‰"], e: "æ­¤ç« ç¯€ä¸»è¦ç ”ç©¶ç•¸èƒå­¸ï¼ˆTeratologyï¼‰èˆ‡ç™¼è‚²ç¼ºé™·ã€‚" },
            { q: "é—œæ–¼è„Šæ¤è£‚ï¼ˆSpina bifidaï¼‰çš„æ•˜è¿°ï¼Œä¸‹åˆ—ä½•è€…æ­£ç¢ºï¼Ÿ", a: "ç‚ºè„Šæ¤èƒŒå´å¼“èåˆå¤±æ•—å°è‡´ç¥ç¶“ç®¡æš´éœ²", o: ["æ˜¯è„Šé«“å—ç—…æ¯’æ„ŸæŸ“å¾Œçš„æ¶²åŒ–å£æ­»", "ç‚ºè„Šæ¤èƒŒå´å¼“èåˆå¤±æ•—å°è‡´ç¥ç¶“ç®¡æš´éœ²", "åƒ…ç™¼ç”Ÿæ–¼è€å¹´å¤§å‹çŠ¬", "æ˜¯ç¶­ç”Ÿç´  D éå¤šå°è‡´çš„éª¨éª¼è®Šç•°"], e: "è„Šæ¤è£‚ç‚ºæ¤å¼“èåˆå¤±æ•—ï¼Œå±¬æ–¼ç¥ç¶“ç®¡ç¼ºé™·ã€‚" }
        ]
    },
    "pigments_calcium": {
        title: "ç¬¬äºŒç« ï¼šè‰²ç´ åŠéˆ£ä»£è¬éšœç¤™",
        questions: [
            { q: "ä¸‹åˆ—ä½•ç¨®è‰²ç´ èˆ‡ç´°èƒè€åŒ–åŠä¸é£½å’Œè„‚è‚ªé…¸çš„éæ°§åŒ–åæ‡‰æœ‰é—œï¼Ÿ", a: "Lipofuscin", o: ["Anthracosis", "Lipofuscin", "Hemosiderin", "Bilirubin"], e: "Lipofuscinï¼ˆè„‚è¤è³ªï¼‰åˆç¨±è€åŒ–è‰²ç´ ã€‚" },
            { q: "åœ¨æ…¢æ€§è¢«å‹•æ€§å……è¡€çš„è‚ºè‡Ÿä¸­ï¼Œå·¨å™¬ç´°èƒåå™¬ç´…è¡€çƒå¾Œç”¢ç”Ÿçš„è‰²ç´ ç‚ºï¼š", a: "Hemosiderin", o: ["Melanin", "Bilirubin", "Hemosiderin", "Hematin"], e: "Hemosiderinï¼ˆå«éµè¡€é»ƒç´ ï¼‰å…§å«éµï¼Œæ™®é­¯å£«è—æŸ“è‰²å‘ˆè—è‰²é™½æ€§ã€‚" },
            { q: "é—œæ–¼è½‰ç§»æ€§éˆ£åŒ–ï¼ˆMetastatic calcificationï¼‰ï¼Œä¸‹åˆ—æ•˜è¿°ä½•è€…æ­£ç¢ºï¼Ÿ", a: "å¸¸èˆ‡è¡€éˆ£æˆ–è¡€ç£·æ¿ƒåº¦ç•°å¸¸å‡é«˜æœ‰é—œ", o: ["åƒ…ç™¼ç”Ÿæ–¼å—æçµ„ç¹”", "å¸¸èˆ‡è¡€éˆ£æˆ–è¡€ç£·æ¿ƒåº¦ç•°å¸¸å‡é«˜æœ‰é—œ", "å±€éƒ¨ç’°å¢ƒ pH ä½æœ‰åˆ©æ²‰è‘—", "æ©Ÿèƒ½ä½ä¸‹å¼•èµ·"], e: "æºæ–¼å…¨èº«æ€§ä»£è¬ç•°å¸¸ï¼ˆå¦‚é«˜è¡€éˆ£ï¼‰ã€‚" },
            { q: "è‚ºè‡Ÿä¸­å¸å…¥ä¸”ç„¡æ³•æ¶ˆåŒ–çš„é»‘è‰²é¡†ç²’ç—…åç‚ºï¼š", a: "Anthracosis", o: ["Melanosis", "Anthracosis", "Hemosiderosis", "Porphyria"], e: "Anthracosis ç‚ºç‚­æœ«æ²ˆè‘—ç—‡ã€‚" },
            { q: "é»ƒç–¸ï¼ˆIcterusï¼‰æ˜¯ç”±æ–¼çµ„ç¹”ä¸­è“„ç©äº†éé‡çš„ä½•ç¨®ç‰©è³ªï¼Ÿ", a: "Bilirubin", o: ["Hemoglobin", "Bilirubin", "Biliverdin", "Ferritin"], e: "é«˜è†½ç´…ç´ è¡€ç—‡å°è‡´é»ƒç–¸ã€‚" },
            { q: "å…ˆå¤©æ€§é»‘è‰²ç´ æ²‰è‘—ç—‡ï¼ˆMelanosisï¼‰åœ¨ç‰›ã€ç¾Šæœ€ä¸å¸¸å‡ºç¾æ–¼ï¼š", a: "å¿ƒè‚Œ", o: ["è‚ºè‡Ÿ", "è…¦è†œ", "å¿ƒè‚Œ", "å¤§è¡€ç®¡å£"], e: "Melanosis å¸¸è¦‹æ–¼è‚ºã€è…¦è†œã€è¡€ç®¡ã€‚" },
            { q: "é—œæ–¼ç‡Ÿé¤Šä¸è‰¯æ€§éˆ£åŒ–ï¼ˆDystrophic calcificationï¼‰ä½•è€…æ­£ç¢ºï¼Ÿ", a: "è¡€éˆ£æ¿ƒåº¦é€šå¸¸ç¶­æŒåœ¨æ­£å¸¸ç¯„åœå…§", o: ["å…¨èº«æ€§ç•°å¸¸", "è¡€éˆ£æ¿ƒåº¦é€šå¸¸ç¶­æŒåœ¨æ­£å¸¸ç¯„åœå…§", "å¥åº·èƒƒé»è†œå¥½ç™¼", "å‰¯ç”²ç‹€è…ºäº¢é€²å¼•èµ·"], e: "ç‡Ÿé¤Šä¸è‰¯æ€§éˆ£åŒ–åƒ…é™å—æçµ„ç¹”ï¼Œè¡€éˆ£æ­£å¸¸ã€‚" },
            { q: "ä¸‹åˆ—å“ªç¨®è‰²ç´ å…·æŠ—é…¸æ€§æŸ“è‰²é™½æ€§ (Acid-fast positive)ï¼Ÿ", a: "Ceroid", o: ["Melanin", "Ceroid", "Hemosiderin", "Hematin"], e: "Ceroidï¼ˆé¡è Ÿè³ªï¼‰å…·æŠ—é…¸æ€§ï¼Œèˆ‡ Vit E ç¼ºä¹æœ‰é—œã€‚" },
            { q: "é…¸æ€§ç¦é¦¬æ—å›ºå®šæ¶²ç”¢ç”Ÿçš„ Artifact ç¨±ç‚ºï¼š", a: "Acid hematin", o: ["Acid hematin", "Bilirubin", "Lipofuscin", "Melanin"], e: "å³ç¦é¦¬æ—è‰²ç´ ã€‚" },
            { q: "å¤§å‹çŠ¬è‚˜éƒ¨å£“åŠ›é»å‡ºç¾çš„éˆ£åŒ–åœ˜å¡Šåç¨±ç‚ºï¼š", a: "Calcinosis circumscripta", o: ["Calcinosis cutis", "Calcinosis circumscripta", "Myositis", "Lipoma"], e: "é™å±€æ€§éˆ£è³ªæ²‰è‘—ã€‚" },
            { q: "(é€²éš) è‚å—é˜»å°è‡´è‘‰ç´…ç´ ï¼ˆPhylloerythrinï¼‰æ’æ³„éšœç¤™æœƒå¼•èµ·å“ªç¨®å…‰æ•æ„Ÿï¼Ÿ", a: "Type III photosensitization", o: ["Type I", "Type II", "Type III photosensitization", "Type IV"], e: "ç¬¬ä¸‰å‹å…‰æ•æ„Ÿç—‡ç‚ºè‚æºæ€§ã€‚" },
            { q: "(é€²éš) Porphyria å—å½±éŸ¿çš„éª¨éª¼åœ¨ç´«å¤–å…‰ä¸‹å‘ˆç¾ï¼š", a: "ç´…è‰²è¢å…‰", o: ["ç¶ è‰²è¢å…‰", "ç´…è‰²è¢å…‰", "é»ƒè‰²è¢å…‰", "ç„¡è¢å…‰"], e: "åŸå•‰è“„ç©åœ¨ç¡¬çµ„ç¹”å…· UV è¢å…‰æ€§ã€‚" },
            { q: "(é€²éš) ç¶¿ç¾Šæ€¥æ€§éŠ…ä¸­æ¯’å°è‡´è…è‡Ÿæ§é‡‘å±¬è‰²ä¸»å› ç‚ºï¼š", a: "Hemoglobinuria", o: ["Hemoglobinuria", "Bilirubinuria", "Hematuria", "Ketonuria"], e: "è¡€ç´…ç´ å°¿æ‰€è‡´ã€‚" },
            { q: "(é€²éš) ç¦½é¡ç—›é¢¨æ²‰è‘—æ–¼æ¼¿è†œé¢çš„ç™½è‰²ç‰©è³ªåŒ–å­¸æˆåˆ†ï¼š", a: "Urates", o: ["Calcium phosphate", "Calcium oxalate", "Urates", "Bilirubin"], e: "ç¦½é¡ä»£è¬å°¿é…¸é¹½ã€‚" },
            { q: "(é€²éš) å½é»‘è‰²ç´ æ²‰è‘—æ˜¯ H2S èˆ‡éµé›¢å­çµåˆæˆï¼š", a: "Iron sulfide", o: ["Iron oxide", "Iron sulfide", "Ferric chloride", "Hematin"], e: "ç”¢ç”Ÿé»‘è‰²çš„ç¡«åŒ–éµã€‚" },
            { q: "(é€²éš) ç¶­ç”Ÿç´  D ä¸­æ¯’å¼•èµ·é«˜è¡€éˆ£ï¼Œéˆ£é¹½æœ€å¸¸æ²‰è‘—åœ¨è¡€ç®¡ï¼š", a: "Tunica media", o: ["Tunica intima", "Tunica media", "Tunica adventitia", "Endothelium"], e: "å—œå½ˆæ€§çº–ç¶­ï¼Œå¸¸åœ¨è¡€ç®¡ä¸­å±¤ã€‚" },
            { q: "(é€²éš) é—œæ–¼é¦¬é»‘è‰²ç´ ç˜¤ï¼ˆEquine melanomaï¼‰ä½•è€…éŒ¯èª¤ï¼Ÿ", a: "ä¸»è¦ç™¼ç”Ÿåœ¨å¹´è¼•ç°æ¯›é¦¬ï¼Œä¸”ç—…ç¨‹æ¥µçŸ­", o: ["å¥½ç™¼æ–¼è€å¹´ç°æ¯›é¦¬", "å¸¸è¦‹æ–¼å°¾æ ¹", "ä¸»è¦ç™¼ç”Ÿåœ¨å¹´è¼•ç°æ¯›é¦¬ï¼Œä¸”ç—…ç¨‹æ¥µçŸ­", "å…·è½‰ç§»æ½›åŠ›"], e: "é¦¬é»‘è‰²ç´ ç˜¤é€²å±•ç·©æ…¢ä¸”ç‚ºè€å¹´ç—…ã€‚" },
            { q: "(é€²éš) å€åˆ†ç„¡é»‘è‰²ç´ å‹é»‘è‰²ç´ ç˜¤å¯æª¢æ¸¬ä½•ç¨®é…µç´ ï¼Ÿ", a: "Tyrosinase", o: ["Tyrosinase", "Alkaline phosphatase", "Acid phosphatase", "Peroxidase"], e: "Tyrosinase æ´»æ€§æ˜¯é—œéµã€‚" },
            { q: "(é€²éš) æº¶è¡€æ€§é»ƒç–¸åœ¨ç”ŸåŒ–æª¢æŸ¥ä¸­ä¸»è¦å‘ˆç¾ï¼š", a: "Unconjugated bilirubin å¢åŠ ", o: ["Conjugated bilirubin å¢åŠ ", "Unconjugated bilirubin å¢åŠ ", "ç³ä¾¿ç°ç™½", "è†½ç®¡é˜»å¡"], e: "å¢åŠ çš„æ˜¯æœªçµåˆå‹è†½ç´…ç´ ã€‚" },
            { q: "(é€²éš) æ…¢æ€§è‚Œè‚‰å£æ­»ç—…ç¶ä¸­å‡ºç¾çš„éˆ£é¹½æ²‰è‘—å±¬æ–¼ï¼š", a: "Dystrophic calcification", o: ["Metastatic", "Dystrophic calcification", "Calcinosis cutis", "Osteogenesis"], e: "å£æ­»å±€éƒ¨çš„éˆ£åŒ–çš†å±¬ç‡Ÿé¤Šä¸è‰¯æ€§ã€‚" }
        ]
    }
};

let currentKey = "";

function init() {
    const list = document.getElementById('chapter-list');
    list.innerHTML = "";
    for(let key in quizDatabase) {
        list.innerHTML += `<button class="btn-chapter" onclick="startQuiz('${key}')">${quizDatabase[key].title}</button>`;
    }
}

function startQuiz(key) {
    currentKey = key;
    document.getElementById('home-view').style.display = "none";
    document.getElementById('quiz-view').style.display = "block";
    document.getElementById('top-title').innerText = quizDatabase[key].title;
    
    const container = document.getElementById('quiz-content');
    container.innerHTML = "";
    quizDatabase[key].questions.forEach((item, i) => {
        let opts = [...item.o].sort(() => Math.random() - 0.5);
        container.innerHTML += `
            <div class="q-block">
                <span class="q-text">${i+1}. ${item.q}</span>
                <div class="opt-list">${opts.map(o => `
                    <input type="radio" name="q${i}" value="${o}" id="q${i}_${o}">
                    <label for="q${i}_${o}">${o}</label>
                `).join("")}</div>
            </div>
        `;
    });
    window.scrollTo(0,0);
}

function gradeQuiz() {
    const qs = quizDatabase[currentKey].questions;
    let score = 0;
    let wrongReport = "";
    let wrongBatch = [];

    for(let i=0; i<qs.length; i++) {
        const sel = document.querySelector(`input[name="q${i}"]:checked`);
        if(!sel) { alert("å°šæœªå®Œæˆæ‰€æœ‰é¡Œç›®ï¼"); return; }
        
        const isCorrect = sel.value === qs[i].a;
        if(isCorrect) score++;
        else {
            let optStr = qs[i].o.map(o => `   - ${o}${o === qs[i].a ? ' (æ­£ç¢ºç­”æ¡ˆ)' : ''}`).join("\n");
            wrongReport += `ã€ç¬¬ ${i+1} é¡Œ éŒ¯èª¤ã€‘\n é¡Œç›®ï¼š${qs[i].q}\n æ‚¨çš„é¸æ“‡ï¼š${sel.value}\n æ‰€æœ‰é¸é …ï¼š\n${optStr}\n è§£æï¼š${qs[i].e}\n------------------\n`;
            wrongBatch.push({ q: qs[i].q, a: qs[i].a, o: qs[i].o, e: qs[i].e, chapter: quizDatabase[currentKey].title });
        }
    }

    saveToBank(wrongBatch);
    document.getElementById('quiz-view').style.display = "none";
    document.getElementById('result-view').style.display = "block";
    document.getElementById('score-text').innerText = `å¾—åˆ†ï¼š${score} / ${qs.length}`;
    document.getElementById('report-text').innerText = `=== æ¸¬é©—å ±è¡¨ ===\nç« ç¯€ï¼š${quizDatabase[currentKey].title}\næˆç¸¾ï¼š${score}/${qs.length}\næ™‚é–“ï¼š${new Date().toLocaleString()}\n\n` + (wrongReport || "æ»¿åˆ†ï¼");

	// åœ¨ gradeQuiz å‡½æ•¸å…§çš„ saveToBank(wrongBatch); ä¹‹å¾ŒåŠ å…¥ï¼š
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxE9ihjdZDBp4h3ZiKB_1_fpf8OBpgUzR45JjgwjZnmkwAHSXosoGPPlsgM5oAFJKvJ/exec';
    const payload = {
        score: score + "/" + qs.length,
        wrongAnswers: wrongReport,
        chapter: quizDatabase[currentKey].title
    };

    fetch(scriptURL, {
        method: 'POST',
        mode: 'no-cors', // é¿å…è·¨ç¶²åŸŸéŒ¯èª¤
        body: JSON.stringify(payload)
    });

    const review = document.getElementById('review-content');
    review.innerHTML = qs.map((item, i) => {
        const selValue = document.querySelector(`input[name="q${i}"]:checked`).value;
        const isCorrect = selValue === item.a;
        let optReview = item.o.map(opt => `<li style="${opt === item.a ? 'color:green;font-weight:bold;' : ''}">${opt}</li>`).join("");
        
        return `
            <div class="q-block" style="border: 1px solid #eee; padding: 15px; border-radius: 8px;">
                <p><strong>${i+1}. ${item.q}</strong></p>
                <ul style="list-style-type: circle; font-size: 0.9em; color: #666;">${optReview}</ul>
                <div class="feedback ${isCorrect ? 'correct' : 'wrong'}">${isCorrect ? 'âœ“ æ­£ç¢º' : 'âœ— éŒ¯èª¤ï¼Œæ‚¨é¸ï¼š' + selValue}</div>
                <div class="exp">è§£æï¼š${item.e}</div>
            </div>
        `;
    }).join("");
    window.scrollTo(0,0);
}

function saveToBank(list) {
    let bank = JSON.parse(localStorage.getItem('vet_wrong_bank')) || [];
    list.forEach(item => {
        if(!bank.some(b => b.q === item.q)) bank.push(item);
    });
    localStorage.setItem('vet_wrong_bank', JSON.stringify(bank));
}

function showWrongBank() {
    document.getElementById('home-view').style.display = "none";
    document.getElementById('bank-view').style.display = "block";
    const bank = JSON.parse(localStorage.getItem('vet_wrong_bank')) || [];
    const content = document.getElementById('bank-content');
    if(bank.length === 0) {
        content.innerHTML = "<p style='text-align:center; padding:30px;'>ç›®å‰å°šç„¡ç´€éŒ„ã€‚åŠ æ²¹ï¼</p>";
    } else {
        content.innerHTML = bank.map((item, i) => {
            let opts = item.o.map(o => `<li style="${o === item.a ? 'color:green;font-weight:bold;' : ''}">${o}</li>`).join("");
            return `
                <div class="q-block">
                    <p><small>[${item.chapter}]</small><br><strong>${i+1}. ${item.q}</strong></p>
                    <ul style="list-style-type: disc; font-size: 0.85em; color: #555; margin-left: 20px;">${opts}</ul>
                    <div class="exp" style="margin-top:10px;">è§£æï¼š${item.e}</div>
                </div>
            `;
        }).join("");
    }
}

function clearBank() {
    if(confirm("ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰çš„éŒ¯é¡Œç´€éŒ„å—ï¼Ÿ")) {
        localStorage.removeItem('vet_wrong_bank');
        showWrongBank();
    }
}

function copyReport() {
    const txt = document.getElementById('report-text').innerText;
    navigator.clipboard.writeText(txt).then(() => alert("å®Œæ•´å ±è¡¨å·²è¤‡è£½ï¼"));
}

function goHome() {
    location.reload();
}

init();
</script>
</body>
</html>